<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Danh sách Đội Bóng</title>
    <link rel="icon" type="logo.png" href="/images/logo.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />

    <link rel="stylesheet" href="/user/css/sidebar.css" />
    <link rel="stylesheet" href="/user/css/userheader.css" />
    <link rel="stylesheet" href="/user/css/userfooter.css" />

    <link
      rel="stylesheet"
      href="/user/seasonManagement/css/management-actions.css"
    />
    <style>
      /* --- CSS CÓ SẴN --- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Oswald, sans-serif;
        text-decoration: none;
      }
      body {
        background-color: white;
      }
      .container {
        display: flex;
        width: 100%;
      }
      .content-wrapper {
        flex: 1;
        display: block;
        margin: 0;
        padding: 0;
        background-color: #ecf0f5;
      }
      .content {
        background-color: white;
        border-radius: 5px;
        margin: 15px;
        padding-bottom: 1px;
      }
      .list-league {
        color: rgb(34, 34, 34);
        font-size: 24px;
        font-weight: normal;
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        border-bottom: 1px solid #eee;
      }
      .list-league_left {
        font-family: "Source Sans Pro", sans-serif !important;
      }
      .list-league .fa-solid.fa-list {
        color: #ff6f00;
        margin-right: 8px;
        font-size: 25px;
      }
      .list-league_left {
        flex-grow: 1;
      }
      .fa-solid.fa-plus {
        margin-right: 3px;
        font-size: 15px;
      }
      .Nhaplai {
        color: rgb(255, 255, 255);
        padding: 7px 12px 6px 12px;
        background-color: rgb(0, 172, 236);
        border-color: rgba(0, 0, 0, 0.25);
        border-style: solid;
        border-width: 0.8px;
        cursor: pointer;
        text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 0px;
        box-shadow: 0px -1px 5px rgba(0, 0, 0, 0.1);
        border-radius: 3px;
      }
      .Nhaplai:hover {
        background-color: #428bca;
      }

      /* === CSS ĐÃ SỬA ĐỔI CHO DANH SÁCH ĐỘI === */
      #team-display-area {
        padding: 15px; /* Giữ padding cho khu vực chung */
      }

      #team-display-area ul.team-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex; /* *** Sử dụng Flexbox *** */
        flex-wrap: wrap; /* *** Cho phép xuống dòng *** */
        gap: 15px; /* *** Khoảng cách giữa các item *** */
      }

      #team-display-area li.team-item {
        display: flex;
        align-items: center;
        /* *** Chiều rộng để có 2 cột (trừ đi khoảng cách gap) *** */
        flex-basis: calc(50% - 8px); /* 8px là khoảng 1/2 gap */
        min-width: 300px; /* Chiều rộng tối thiểu trước khi chỉ còn 1 cột */

        padding: 10px 12px; /* *** Giảm padding dọc *** */
        background-color: #ffffff;
        border: 1px solid #e7e7e7;
        border-radius: 5px; /* *** Giảm bo góc một chút *** */
        transition: background-color 0.2s ease, box-shadow 0.2s ease,
          border-color 0.2s ease;
        /* cursor: pointer; Bỏ cursor pointer nếu chỉ có nút là tương tác chính */
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        overflow: hidden; /* Đảm bảo nội dung không tràn ra ngoài */
      }

      #team-display-area li.team-item:hover {
        background-color: #f8f9fa;
        border-color: #dcdcdc;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      #team-display-area li.team-item img.team-logo {
        width: 45px; /* *** Giảm kích thước logo *** */
        height: 45px;
        object-fit: contain;
        border-radius: 50%;
        margin-right: 12px; /* *** Giảm khoảng cách logo *** */
        border: 1px solid #eee; /* Viền mỏng hơn */
        background-color: #fff;
        flex-shrink: 0;
        padding: 2px;
      }

      #team-display-area li.team-item .team-info {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        /* justify-content: center; */ /* Căn giữa nếu muốn */
      }

      #team-display-area li.team-item .team-name {
        font-size: 17px; /* *** Giảm cỡ chữ tên đội *** */
        font-weight: 600;
        color: #333; /* Đổi màu chữ đậm hơn */
        margin-bottom: 3px; /* *** Giảm khoảng cách dưới tên *** */
        line-height: 1.3;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: "Source Sans Pro", sans-serif; /* Dùng font phụ cho tên */
      }

      #team-display-area li.team-item .team-manager {
        font-size: 13px; /* *** Giảm cỡ chữ quản lý *** */
        color: #667; /* Màu nhạt hơn */
        font-family: "Source Sans Pro", sans-serif;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* CSS cho nút hành động */
      #team-display-area li.team-item .team-actions {
        margin-left: 10px; /* *** Giảm khoảng cách trước nút *** */
        flex-shrink: 0;
        display: flex;
        gap: 6px; /* *** Giảm khoảng cách giữa các nút *** */
      }

      #team-display-area li.team-item .team-actions button {
        padding: 5px 8px; /* *** Giảm padding nút *** */
        font-size: 12px; /* *** Giảm cỡ chữ icon nút *** */
        cursor: pointer;
        border: none;
        border-radius: 3px;
        transition: opacity 0.2s ease;
        line-height: 1; /* Đảm bảo icon căn giữa */
      }
      #team-display-area li.team-item .team-actions button:hover {
        opacity: 0.8;
      }

      #team-display-area li.team-item .team-actions .edit-btn {
        background-color: #ffc107;
        color: #333;
      }

      #team-display-area li.team-item .team-actions .delete-btn {
        background-color: #dc3545;
        color: white;
      }
      /* === HẾT CSS ĐÃ SỬA ĐỔI === */
    </style>
  </head>
  <body>
    <header id="header-container" class="header"></header>
    <div class="container">
      <div id="sidebar-container"></div>
      <div class="content-wrapper">
        <div class="management-actions">
          <!-- Các nút action giữ nguyên -->
          <a href="lichthidau.html" class="action-button">
            <i class="fa-solid fa-calendar-days"></i> <span>LỊCH THI ĐẤU</span>
          </a>
          <a href="bangxephang.html" class="action-button">
            <i class="fa-solid fa-ranking-star"></i> <span>BẢNG XẾP HẠNG</span>
          </a>
          <a href="doithamdu.html" class="action-button">
            <i class="fa-solid fa-users"></i> <span>ĐỘI THAM DỰ</span>
          </a>
          <a href="kqboctham.html" class="action-button">
            <i class="fa-solid fa-list"></i> <span>KẾT QUẢ BỐC THĂM</span>
          </a>
          <a href="seasonManagement/thongke.html" class="action-button">
            <i class="fa-solid fa-chart-simple"></i> <span>THỐNG KÊ</span>
          </a>
          <a href="news.html" class="action-button">
            <i class="fa-solid fa-newspaper"></i> <span>TIN TỨC-THÔNG BÁO</span>
          </a>
          <a href="/user/EditSeason.html" class="action-button">
            <i class="fa-solid fa-gears"></i> <span>CẤU HÌNH MÙA GIẢI</span>
          </a>
          <a href="phanquyen.html" class="action-button">
            <i class="fa-solid fa-shield-halved"></i> <span>PHÂN QUYỀN</span>
          </a>
        </div>
        <section class="content">
          <div class="list-league">
            <span class="list-league_left">
              <i class="fa-solid fa-list"></i>Danh sách tất cả đội bóng
            </span>
            <div class="wrap">
              <a href="themdoithamdu.html" id="register-link-generic">
                <button class="Nhaplai">
                  <i class="fa-solid fa-plus"></i> Thêm đội mới
                </button>
              </a>
            </div>
          </div>
          <div id="team-display-area">
            <p style="text-align: center; font-style: italic; padding: 20px">
              Chưa có đội bóng nào...
            </p>
          </div>
          <footer id="footer" class="footer"></footer>
        </section>
      </div>
    </div>

    <script src="/user/js/sidebar.js"></script>
    <script src="/user/js/userheader.js"></script>
    <script src="/user/js/componentloader.js"></script>

    <!-- Script hiển thị đội (JavaScript không đổi nhiều, chủ yếu là CSS) -->
    <script name="displayAllTeams">
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM fully loaded and parsed for displayAllTeams");

        const teamDisplayArea = document.getElementById("team-display-area");
        if (!teamDisplayArea) {
          console.error(
            "FATAL: Phần tử #team-display-area không tồn tại trong HTML!"
          );
          return;
        }

        let allTeams = [];
        try {
          const storedTeams = localStorage.getItem("teams");
          console.log(
            "Raw data từ localStorage.getItem('teams'):",
            storedTeams
          );

          if (storedTeams) {
            allTeams = JSON.parse(storedTeams);
            if (!Array.isArray(allTeams)) {
              console.error(
                "Lỗi: Dữ liệu trong localStorage 'teams' không phải là một mảng hợp lệ."
              );
              allTeams = [];
              teamDisplayArea.innerHTML =
                '<p style="color: red; text-align: center; padding: 20px;"><i>Lỗi: Định dạng dữ liệu đội bóng không hợp lệ.</i></p>';
              return;
            }
            console.log("Dữ liệu sau khi JSON.parse:", allTeams);
          } else {
            console.log("Không tìm thấy key 'teams' trong localStorage.");
          }
        } catch (e) {
          console.error("Lỗi nghiêm trọng khi parse JSON từ localStorage:", e);
          teamDisplayArea.innerHTML =
            '<p style="color: red; text-align: center; padding: 20px;"><i>Lỗi khi tải dữ liệu đội. Dữ liệu có thể bị hỏng.</i></p>';
          return;
        }

        console.log(`Tổng số đội tìm thấy: ${allTeams.length}`);

        if (allTeams.length === 0) {
          teamDisplayArea.innerHTML =
            '<p style="text-align: center; font-style: italic; padding: 20px;">Chưa có đội bóng nào.</p>';
        } else {
          let teamsHTML = '<ul class="team-list">'; // Sử dụng class đã định nghĩa trong CSS
          allTeams.forEach((team, index) => {
            console.log(`Processing team index ${index}:`, team);

            if (typeof team !== "object" || team === null) {
              console.warn(`Bỏ qua item không hợp lệ ở index ${index}:`, team);
              return;
            }

            const logoSrc =
              team.logo && team.logo.startsWith("data:image")
                ? team.logo
                : "/images/logo.png";
            const teamName = team.teamName || "Chưa có tên";
            const managerName = team.managerName || "Chưa cập nhật";
            const teamId = team.id || `no-id-${index}`;

            // Sử dụng các class CSS đã định nghĩa
            teamsHTML += `
                        <li class="team-item" data-team-id="${teamId}">
                            <img src="${logoSrc}" alt="Logo ${teamName}" class="team-logo">
                            <div class="team-info">
                                <strong class="team-name">${teamName}</strong>
                                <span class="team-manager">Quản lý: ${managerName}</span>
                            </div>
                            <div class="team-actions">
                                <button class="edit-btn" onclick="editTeam('${teamId}')" title="Chỉnh sửa"> <i class="fa-solid fa-pencil"></i> </button>
                                <button class="delete-btn" onclick="handleDelete('${teamId}')" title="Xóa"> <i class="fa-solid fa-trash-can"></i> </button>
                            </div>
                        </li>
                    `;
          });
          teamsHTML += "</ul>";
          teamDisplayArea.innerHTML = teamsHTML;

          console.log("Đã hiển thị xong danh sách đội.");
        }
      });

      // --- Hàm xử lý nút Sửa (ĐÃ SỬA ĐỔI) ---
      function editTeam(teamId) {
        console.log("Nút sửa được nhấn cho đội:", teamId);
        // Hiển thị thông báo alert theo yêu cầu
        alert(
          "Bạn không có quyền chỉnh sửa đội bóng này. Chỉ có người quản lý đội bóng mới có thể chính sửa thông tin đội bóng"
        );
        // Không làm gì khác
      }

      // --- Hàm xử lý nút Xóa (Giữ nguyên logic) ---
      function handleDelete(teamId) {
        console.log("Xóa đội:", teamId);
        const teamItem = document.querySelector(
          `li[data-team-id="${teamId}"] .team-name`
        );
        const teamName = teamItem ? teamItem.textContent : `ID ${teamId}`;

        if (
          confirm(
            `Bạn có chắc chắn muốn xóa đội "${teamName}" không?\nHành động này không thể hoàn tác!`
          )
        ) {
          try {
            let currentTeams = JSON.parse(
              localStorage.getItem("teams") || "[]"
            );
            const updatedTeams = currentTeams.filter(
              (t) => t && t.id !== teamId
            );

            if (updatedTeams.length < currentTeams.length) {
              localStorage.setItem("teams", JSON.stringify(updatedTeams));
              console.log(`Đã xóa đội ${teamId} khỏi localStorage.`);
              const listItem = document.querySelector(
                `li[data-team-id="${teamId}"]`
              );
              if (listItem) {
                listItem.remove();
                if (
                  document.querySelectorAll("#team-display-area li.team-item")
                    .length === 0
                ) {
                  document.getElementById("team-display-area").innerHTML =
                    '<p style="text-align: center; font-style: italic; padding: 20px;">Chưa có đội bóng nào được lưu.</p>';
                }
              }
              alert(`Đã xóa đội "${teamName}".`);
            } else {
              console.warn(`Không tìm thấy đội với ID ${teamId} để xóa.`);
              alert(`Không tìm thấy đội để xóa.`);
            }
          } catch (e) {
            console.error("Lỗi khi xóa đội từ localStorage:", e);
            alert("Đã xảy ra lỗi khi xóa đội.");
          }
        } else {
          console.log("Hủy xóa đội:", teamId);
        }
      }
    </script>
    <!-- *** KẾT THÚC SCRIPT HIỂN THỊ *** -->
  </body>
</html>
