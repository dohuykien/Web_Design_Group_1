<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trang tạo mùa giải</title>
    <link rel="icon" type="logo.png" href="images/logo.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link rel="stylesheet" href="/user/css/sidebar.css" />
    <link rel="stylesheet" href="/user/css/userheader.css" />
    <link rel="stylesheet" href="/user/css/userfooter.css" />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Oswald, sans-serif;
        text-decoration: none;
      }
      body {
        background-color: white;
      }
      /*-------------------------Header---------------------------*/
      .developed-by {
        position: absolute;
        left: 250px;
        top: 7px;
        color: #ffffff;
        font-size: 14px;
        z-index: 2;
      }
      .navbar-top {
        background-color: #1565c0;
        color: white;
        padding: 10px 20px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 75px;
      }
      .navbar-bottom {
        position: relative;
      }
      /*Logo*/
      .logo {
        display: flex;
        align-items: center;
        z-index: 2;
        left: 170px;
      }
      .logo img {
        height: 65px;
        max-width: 100%;
        margin-right: 10px;
      }
      /* Menu chính */
      .navbar-collapse {
        background-color: #ff6f00;
        padding: 7px 0px;
        height: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1;
      }
      .navbar-collapse::before {
        content: "";
        position: absolute;
        top: -40px;
        left: -15px;
        width: 101%;
        height: 50px;
        background-color: #ff6f00;
        clip-path: polygon(0 350%, 15% 0, 100% 0, 100% 100%);
      }
      .navbar-nav {
        display: flex;
        margin-left: -200px;
      }
      .navbar-nav li a {
        left: 10px;
        color: white;
        text-decoration: none;
        /* margin: 0 7px; */
        top: -20px;
        position: relative;
        z-index: 2;
        font-size: 16px;
      }
      .nav-item {
        padding: 0 15px;
        list-style: none;
      }
      .navbar-nav a:hover {
        text-decoration: underline;
      }

      /* Responsive cho Mobile */
      @media (max-width: 768px) {
        .navbar-collapse {
          display: none;
          flex-direction: column;
          width: 100%;
          background: #fff;
          position: absolute;
          top: 50px;
          left: 0;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .navbar-collapse.active {
          display: flex;
        }

        .nav-item {
          text-align: center;
          padding: 10px 0;
        }
      }
      .header .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative; /* Đổi từ absolute sang relative */
        right: 60px;
        top: -20px;
        cursor: pointer;
        z-index: 1000;
      }
      .header .user-info img {
        width: 30px;
        height: 30px;
      }
      .user-info span i {
        position: relative;
        top: -2px;
      }

      .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background-color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        min-width: 160px;
        z-index: 1000;
        padding: 5px 0px;
      }

      .dropdown-menu a {
        display: block;
        padding: 5px 15px;
        color: #333333;
        text-decoration: none;
        transition: background-color 0.3s;
        font-size: 14px;
      }

      .dropdown-menu a:hover {
        background-color: #f34541;
        color: #ffffff;
      }
      .fa-solid.fa-caret-down {
        color: #333333;
        font-size: 12px;
        margin-top: 10px;
      }
      /*-------------------End Header---------------------- */

      /*----------------------Layout-------------------------*/
      .container {
        display: flex;
        width: 100%;
      }
      /*-------------------Sidebar--------------------- */
      .sidebar {
        width: 230px;
        background: #333333;
        color: #b8c7ce;
        min-height: 648px;
        height: 99.5%;
        position: relative;
        bottom: 2px;
        z-index: 1;
      }
      .sidebar ul {
        list-style: none;
        background-color: #2c3b41;
      }
      .sidebar ul li {
        padding: 9px 5px 9px 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid #ffffff;
        cursor: pointer;
        transition: color 0.2s;
      }
      .sidebar ul li:hover {
        color: #ffffff;
      }
      .sidebar ul li i {
        width: 20px;
        text-align: center;
      }
      .sidebar a {
        text-decoration: none;
        flex: 1;
        color: #b8c7ce;
      }
      .sidebar a:hover {
        color: #ffffff;
      }

      .fa-solid.fa-tachometer-alt {
        color: #ff6f00;
      }

      /* Ẩn submenu ban đầu */
      .submenu {
        display: none;
        background: #ff6f00 !important;
      }

      .submenu li {
        padding: 12px 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        width: 100%;
        height: 32px;
      }
      .submenu a {
        color: #222222 !important;
      }
      .submenu li:hover {
        background: #ffffff;
      }
      .submenu a:hover {
        color: rgb(250, 55, 25) !important;
      }

      /* Bật submenu khi click */
      .menu-item.active + .submenu {
        display: block;
      }

      /* Định dạng cho menu cha */
      .menu-item {
        display: flex;
        align-items: center;
        padding: 15px 15px;
        cursor: pointer;
        width: 100%;
      }

      .menu-item i {
        margin-right: 10px;
      }
      .fa-solid.fa-play {
        font-size: 9px;
        color: #222222;
      }
      .fa-solid.fa-chevron-down {
        font-size: 12px;
        margin-left: auto;
      }
      /* -------------------sidebar-end------------------- */

      /*----------content: list-league + footer------------ */
      .content-wrapper {
        flex: 1;
        display: block;
        margin: 0;
        padding: 0;
      }
      .content {
        background-color: white;
        border-radius: 5px;
      }
      /* list-league */
      .list-league {
        color: rgb(34, 34, 34);
        font-size: 24px;
        font-weight: normal;
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }
      .list-league_left {
        font-family: "Source Sans Pro", sans-serif !important;
      }
      .fa-solid.fa-check {
        color: #ff6f00;
        margin-right: 8px;
        font-size: 25px;
      }
      .list-league_left {
        flex-grow: 1;
      }

      .save {
        color: rgb(255, 255, 255);
        padding: 7px 12px 6px 12px;
        background-color: #49bf67;
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
        border-style: solid;
        border-width: 0.8px;
        cursor: pointer;
        text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 0px;
        box-shadow: 0px -1px 5px rgba(0, 0, 0, 0.1);
      }
      .save:hover {
        background-color: #379e51;
      }
      .fa-solid.fa-rotate {
        margin-right: 3px;
        font-size: 15px;
      }
      .fa-regular.fa-floppy-disk {
        margin-right: 3px;
        font-size: 15px;
      }
      .Nhaplai {
        color: rgb(255, 255, 255);
        padding: 7px 12px 6px 12px;
        background-color: rgb(0, 172, 236);
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
        border-style: solid;
        border-width: 0.8px;
        cursor: pointer;
        text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 0px;
        box-shadow: 0px -1px 5px rgba(0, 0, 0, 0.1);
      }
      .Nhaplai:hover {
        background-color: #428bca;
      }
      .return {
        color: rgb(255, 255, 255);
        padding: 7px 12px 6px 12px;
        background-color: #f34541;
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
        border-style: solid;
        border-width: 0.8px;
        cursor: pointer;
        text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 0px;
        box-shadow: 0px -1px 5px rgba(0, 0, 0, 0.1);
      }
      .return:hover {
        background-color: #dd1b18;
      }

      /*---------------------inputseason------------------*/
      .kienngu {
        background-color: #ecf0f5;
        padding-top: 10px;
        border-top: 1px solid #e4e2e2;
      }
      .box {
        display: flex;
      }
      .success {
        max-width: 1250px;
        margin: 10px 30px 5px 30px;
        padding: 7px 15px 7px 15px;
        color: rgb(1, 167, 1);
        font-size: 14px;
        background-color: rgb(221, 253, 221);
        border: 1px solid #e4e2e2;
        display: none;
      }
      .box-left {
        max-width: 1250px;
        margin: 12px 15px 0 30px;
        padding: 0 20px 5px 20px;
        background: #ffffff;
        border: 1px solid #e4e2e2;
        border-radius: 3px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        flex: 2;
      }
      .nguyenkhi {
        max-width: 1250px;
        margin: 20px 15px 0 30px;
        padding: 5px 10px;
        background: #ccc;
        color: #fff;
        border: 1px solid #e4e2e2;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
        flex: 2;
      }
      .chiabang {
        max-width: 1250px;
        margin: -1px 15px 0 30px;
        padding: 0 20px 5px 20px;
        background: #ffffff;
        border: 1px solid #e4e2e2;
        border-radius: 3px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        flex: 2;
        transition: opacity 0.3s ease;
      }
      .box-right {
        max-width: 1000px;
        margin: 12px 30px 0 15px;
        padding: 5px 15px 30px 15px;
        background: #ffffff;
        border: 1px solid #e4e2e2;
        border-radius: 3px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        flex: 1;
        max-height: fit-content;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
      }
      .col {
        flex: 1;
        padding: 10px;
        min-width: 230px;
      }
      .box-left label {
        font-size: 14px;
        display: block;
        margin-bottom: 5px;
      }
      input,
      select {
        width: 100%;
        padding: 8px 6px;
        margin-top: 5px;
        border: 1px solid #ccc;
        box-shadow: rgba(0, 0, 0, 0.075) 0px 1px 1px 0px inset;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      input:focus {
        outline: 0;
        border-color: #969696;
      }
      .toggle {
        width: 60px;
        height: 20px;
        background-color: rgb(240, 22, 17);
        border-radius: 100rem;
        transition: all 0.1s linear;
      }
      .spinner {
        border-radius: 100rem;
        width: 20px;
        height: 20px;
        background-color: white;
        transition: all 0.1s linear;
      }
      .toggle-label input {
        display: none;
      }
      toggle-label {
        cursor: pointer;
        display: inline-block;
      }
      .toggle-label input:checked + .toggle {
        background-color: #49bf67;
      }
      .toggle-label input:checked + .toggle .spinner {
        transform: translateX(40px);
      }
      /*-----------------General File Upload Label-------------------*/
      .file-upload-label {
        display: inline-block; /* Default */
        padding: 8px 15px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
        font-size: 15px;
        text-align: center;
        border: 1px solid transparent;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      .file-upload-label i {
        margin-right: 5px;
      }
      .file-upload-label:hover {
        background-color: #0056b3; /* Darker hover */
      }
      .file-upload-label.file-upload {
        display: block; /* Make it block level */
        width: 100%; /* Make it full width */
        box-sizing: border-box; /* Include padding in width */
        margin-top: 5px; /* Add space below the main label */
        background-color: #49bf67; /* Info color */
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
        box-shadow: 0px -1px 5px rgba(0, 0, 0, 0.1);
      }
      .file-upload-label.file-upload:hover {
        background-color: #4d9e51;
      }
      /* Specific Kit Preview Area - NOW FULL WIDTH */
      .file-preview {
        width: 100%; /* Make the container full width */
        margin-top: 15px; /* Space above the preview */
        border: 1px dashed #ccc;
        border-radius: 6px;
        min-height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 8px;
        box-sizing: border-box;
        background-color: #fff;
      }
      .file-preview:empty {
        min-height: 100px; /* Explicitly set for empty kit preview */
      }
      .file-preview img {
        max-width: 100%; /* Image fits container width */
        max-height: 80px;
        display: block;
        border-radius: 8px;
        object-fit: contain; /* Maintain aspect ratio */
        border: none; /* Remove inner border if not needed */
      }

      .location,
      .fanpage {
        margin-top: 10px;
      }
      .location input,
      .fanpage input {
        margin-top: 8px;
      }
      /* ------------------inputseason-end-----------------*/
    
    </style>
  </head>
  <body>
    <header class="header">
      <div class="navbar">
        <div class="navbar-top">
          <div class="logo">
            <a href="#"><img src="images/logo.png" alt="Logo" /></a>
          </div>
          <span class="developed-by">
            Hệ thống được phát triển bởi HD Promotion</span
          >
          <div class="user-info" onclick="toggleDropdown()">
            <img src="images/dhk.jpg" />
            <span
              >Hải Đăng Nguyễn
              <i class="fa-solid fa-caret-down"></i>
            </span>
            <div class="dropdown-menu" id="dropdownMenu">
              <a href="Dashboard.html">Trang quản lý</a>
              <a href="#">Đăng xuất</a>
            </div>
          </div>
        </div>
        <div class="navbar-bottom">
          <div class="navbar-collapse">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a href="#" class="nav-link">TRANG CHỦ</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">GIẢI ĐANG DIỄN RA</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">GIẢI ĐANG THEO DÕI</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">ĐỘI BÓNG</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">BẮT ĐỐI</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">HƯỚNG DẪN</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">CUỘC THI</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">TIN TỨC</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <div id="sidebar-container">
        <!-- Sidebar will be loaded here -->
      </div>
      <div class="content-wrapper">
        <section class="content">
          <div class="list-league">
            <i class="fa-solid fa-check"></i>
            <span class="list-league_left">Thêm mùa giải</span>

            <div class="wrap">
              <a href="#">
                <button class="save">
                  <i class="fa-regular fa-floppy-disk"></i> Lưu
                </button>
              </a>
              <a href="addseason.html">
                <button class="Nhaplai">
                  <i class="fa-solid fa-rotate"></i> Nhập lại
                </button>
              </a>
              <a href="danhsachmuagiai.html">
                <button class="return">
                  <i class="fa-solid fa-arrow-left"></i> Danh sách mùa giải
                </button>
              </a>
            </div>
          </div>

          <div class="kienngu">
            <div class="success">Thêm thành công</div>
            <div class="box">
              <div>
                <div class="box-left">
                  <div class="row">
                    <div class="col">
                      <label>Tên mùa giải</label>
                      <input type="text" id="tenMuaGiai" />
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Thời gian bắt đầu</label>
                      <input
                        type="text"
                        id="thoiGianBatDau"
                        placeholder="Thời gian bắt đầu"
                        onfocus="(this.type='date')"
                        onblur="if(!this.value) this.type='text'"
                        style="background-color: #eeeeee"
                      />
                    </div>
                    <div class="col">
                      <label>Thời gian kết thúc</label>
                      <input
                        type="text"
                        id="thoiGianKetThuc"
                        placeholder="Thời gian kết thúc"
                        onfocus="(this.type='date')"
                        onblur="if(!this.value) this.type='text'"
                        style="background-color: #eeeeee"
                      />
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Số đội tham dự</label>
                      <input type="number" id="soDoiThamDu" />
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Thể thức thi đấu</label>
                      <select>
                        <option>Vòng tròn</option>
                        <option>Chia bảng</option>
                      </select>
                    </div>
                    <div class="col">
                      <label>Số lượt đá vòng tròn</label>
                      <select>
                        <option>1 lượt</option>
                        <option>2 lượt</option>
                        <option>3 lượt</option>
                        <option>4 lượt</option>
                        <option>5 lượt</option>
                      </select>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Điểm thắng</label>
                      <input type="number" value="3" />
                    </div>
                    <div class="col">
                      <label>Điểm hòa</label>
                      <input type="number" value="1" />
                    </div>
                    <div class="col">
                      <label>Điểm thua</label>
                      <input type="number" value="0" />
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label
                        for="toggle"
                        class="toggle-label"
                        style="display: flex"
                        >Tranh giải ba
                        <input type="checkbox" name="" id="toggle" />
                        <div class="toggle" style="margin-left: 20px">
                          <div class="spinner"></div>
                        </div>
                      </label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Số cầu thủ 1 đội</label>
                      <input type="number" />
                    </div>
                    <div class="col">
                      <label>Số thành viên ban huấn luyện</label>
                      <input type="number" />
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Số hiệp - set 1 trận</label>
                      <input type="number" />
                    </div>
                    <div class="col">
                      <label>Thời gian 1 hiệp - set (phút)</label>
                      <input type="number" />
                    </div>
                  </div>
                </div>
                <div class="nguyenkhi">CẤU HÌNH BẢNG ĐẤU VÀ VÒNG KNOCKOUT</div>
                <div class="chiabang">
                  <div class="row">
                    <div class="col">
                      <label>Tổng số bảng</label>
                    </div>
                    <div class="col">
                      <input type="number" value="1" />
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label>Số đội nhất bảng</label>
                      <input type="number" value="0" />
                    </div>
                    <div class="col">
                      <label>Số đội nhì bảng</label>
                      <input type="number" value="0" />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <label>Số đội thứ ba bảng</label>
                      <input type="number" value="0" />
                    </div>
                    <div class="col">
                      <label>Số đội thứ tư bảng</label>
                      <input type="number" value="0" />
                    </div>
                  </div>
                </div>
              </div>
              <!-- end box-left-->

              <!-- box-right -->
              <div class="box-right">
                <div>
                  <label>Logo</label>
                  <label for="logoFile" class="file-upload-label file-upload">
                    <i class="fas fa-upload"></i> Chọn ảnh...
                  </label>
                  <input
                    type="file"
                    id="logoFile"
                    name="imageFile"
                    accept="image/*"
                    style="display: none"
                  />
                  <div id="logoPreview" class="file-preview"></div>
                  <!-- Preview area -->
                </div>

                <div>
                  <label>Hình nền</label>
                  <label for="wpFile" class="file-upload-label file-upload">
                    <i class="fas fa-upload"></i> Chọn ảnh...
                  </label>
                  <input
                    type="file"
                    id="wpFile"
                    name="imageFile"
                    accept="image/*"
                    style="display: none"
                  />
                  <div id="wpPreview" class="file-preview"></div>
                  <!-- Preview area -->
                </div>
                <div class="location">
                  <label for="location">Địa điểm thi đấu</label>
                  <input type="text" id="location" placeholder="Nhập vị trí" />
                </div>
                <div class="fanpage">
                  <label for="fanpage">Fanpage giải đấu</label>
                  <input type="text" id="fanpage" />
                </div>
              </div>
            </div>
            <div class="footer">
                <div class="footer-container">
                    <div class="footer-left">
                    <p>Bản quyền thuộc HD Promotion</p>
                    <p>Nguyen Hai Dang</p>
                    <p>
                        Chỉ được phát hành lại nội dung khi có sự đồng ý của HD
                        Promotion
                    </p>
                    <div class="footer-apps">
                        <a href=""><img src="images/logo.png" alt="IT League" /></a>
                        <a href=""
                        ><img src="images/googleplay.png" alt="Google Play"
                        /></a>
                        <a href=""
                        ><img src="images/appstore.png" alt="App Store"
                        /></a>
                    </div>
                    </div>
                    <div class="footer-right">
                    <p>
                        <i class="fa fa-building" aria-hidden="true"></i> CÔNG TY CỔ
                        PHẦN TỔ CHỨC SỰ KIỆN VÀ TRUYỀN THÔNG HD Promotion
                    </p>
                    <p>
                        <i class="fa fa-map-marker" aria-hidden="true"></i> Số 185,
                        Trần Đại Nghĩa, phường Đồng Tâm, quận Hai Bà Trưng, Hà Nội
                    </p>
                    <p>
                        <i class="fa fa-phone" aria-hidden="true"></i> 0797102555
                    </p>
                    <p>
                        <i class="fa fa-envelope" aria-hidden="true"></i>
                        nguyenstorm2k5@gmail.com
                    </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script src="/user/js/sidebar.js"></script>
    <script name="sidebar">
      fetch("/user/sidebar.html") // Adjust path
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.text();
        })
        .then((html) => {
          const container = document.getElementById("sidebar-container");
          if (container) {
            container.innerHTML = html;
            // IMPORTANT: Initialize sidebar JS *after* HTML is inserted
            initializeSidebar();
          } else {
            console.error("Sidebar container not found!");
          }
        })
        .catch((error) => {
          console.error("Error loading sidebar:", error);
          const container = document.getElementById("sidebar-container");
          if (container) container.innerHTML = "<p>Error loading sidebar.</p>";
        });

      // submenu-user_info
      function toggleDropdown() {
        var menu = document.getElementById("dropdownMenu");
        if (menu) {
          // Check if the element exists
          menu.style.display =
            menu.style.display === "block" ? "none" : "block";
        } else {
          console.warn("Element with ID 'dropdownMenu' not found.");
        }
      }

      // Ẩn dropdown nếu click ra ngoài
      window.addEventListener("click", function (e) {
        var menu = document.getElementById("dropdownMenu");
        var userInfo = document.querySelector(".user-info");

        // Check if both elements exist before proceeding
        if (menu && userInfo) {
          // Check if the click was outside the userInfo element AND outside the dropdown menu itself
          if (!userInfo.contains(e.target) && !menu.contains(e.target)) {
            menu.style.display = "none";
          }
        } else {
          // Optionally log a warning if elements are missing
          // console.warn("Either 'dropdownMenu' or '.user-info' element not found for outside click handler.");
        }
      });
    </script>
    <script>
      // ----- ***** ĐỌC LEAGUE ID TỪ URL ***** -----
      let currentLeagueId = null;
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const leagueIdFromUrl = urlParams.get("leagueId");
        if (leagueIdFromUrl) {
          currentLeagueId = parseInt(leagueIdFromUrl, 10);
          console.log(
            `DEBUG (addseason): Received leagueId: ${currentLeagueId}`
          );
        } else {
          // Chỉ hiện alert, không chuyển trang
          console.error(
            "DEBUG (addseason): CRITICAL - No leagueId found in URL! Cannot create season."
          );
          alert("Lỗi: Không xác định được giải đấu để tạo mùa giải!");
          // Optional: Disable nút Save nếu không có leagueId
          // const saveButtonForDisable = document.querySelector(".save");
          // if (saveButtonForDisable) saveButtonForDisable.disabled = true;
        }
      } catch (e) {
        console.error("DEBUG (addseason): Error reading leagueId from URL:", e);
        alert("Lỗi đọc ID giải đấu từ URL!");
      }
      // ----- KẾT THÚC ĐỌC LEAGUE ID -----
      // Biến lưu Data URL ảnh mùa giải
      let logoDataUrl = null;
      let wpDataUrl = null;

      // --- Preview ảnh và Lưu Data URL ---
      function previewImage(inputId, previewId) {
        /* ... code preview giữ nguyên ... */
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        if (!input || !preview) {
          console.error(
            `DEBUG (addseason): Missing ${inputId} or ${previewId}`
          );
          return;
        }
        input.addEventListener("change", function () {
          preview.innerHTML = "";
          const file = this.files[0];
          let targetVar =
            inputId === "logoFile"
              ? "logoDataUrl"
              : inputId === "wpFile"
              ? "wpDataUrl"
              : null;
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const img = document.createElement("img");
              img.src = e.target.result;
              preview.appendChild(img);
              if (targetVar === "logoDataUrl") {
                logoDataUrl = e.target.result;
                console.log("DEBUG (addseason): Season logo URL set.");
              }
              if (targetVar === "wpDataUrl") {
                wpDataUrl = e.target.result;
                console.log("DEBUG (addseason): Season wallpaper URL set.");
              }
            };
            reader.onerror = (e) => {
              console.error(
                `DEBUG (addseason): FileReader error for ${inputId}:`,
                e
              );
            };
            reader.readAsDataURL(file);
          } else {
            if (targetVar === "logoDataUrl") logoDataUrl = null;
            if (targetVar === "wpDataUrl") wpDataUrl = null;
            if (file) {
              preview.innerHTML = "File không phải ảnh!";
              alert("Vui lòng chọn file ảnh hợp lệ.");
              input.value = null;
            } else {
              console.log(`DEBUG (addseason): No file for ${inputId}.`);
            }
            if (targetVar === "logoDataUrl") logoDataUrl = null;
            if (targetVar === "wpDataUrl") wpDataUrl = null;
          }
        });
      }
      previewImage("logoFile", "logoPreview");
      previewImage("wpFile", "wpPreview");

      // --- Vòng tròn or Chia bảng  ---
      const formatSelect = document.querySelector(".box-left select");
      const thirdPlaceToggleInput = document.querySelector("#toggle");
      const thirdPlaceRow = thirdPlaceToggleInput?.closest(".row");
      const groupConfigSection = document.querySelector(".chiabang");
      const groupConfigHeader = document.querySelector(".nguyenkhi");
      if (
        formatSelect &&
        thirdPlaceRow &&
        groupConfigSection &&
        groupConfigHeader
      ) {
        function updateUIBasedOnFormat() {
          const selectedFormat = formatSelect.value;
          const isChiaBang = selectedFormat === "Chia bảng";
          thirdPlaceRow.style.display = isChiaBang ? "" : "none";
          groupConfigSection.style.display = isChiaBang ? "" : "none";
          groupConfigHeader.style.display = isChiaBang ? "" : "none";
        }
        updateUIBasedOnFormat();
        formatSelect.addEventListener("change", updateUIBasedOnFormat);
      } else {
        console.warn("DEBUG (addseason): Missing elements for format toggle.");
      }

      // --- XỬ LÝ NÚT LƯU MÙA GIẢI (giữ nguyên phần còn lại) ---
      const saveBtn = document.querySelector(".save");
      const successMsg = document.querySelector(".success");
      const tenMuaGiaiInput = document.getElementById("tenMuaGiai");
      const soDoiThamDuInput = document.getElementById("soDoiThamDu");

      // Optional: Vô hiệu hóa nút Lưu nếu không có leagueId ban đầu
      if (currentLeagueId === null && saveBtn) {
        console.warn(
          "DEBUG (addseason): Disabling save button because leagueId is missing."
        );
        saveBtn.disabled = true;
        saveBtn.style.opacity = 0.6; // Làm mờ nút
        saveBtn.style.cursor = "not-allowed";
        // Có thể thêm thông báo vào gần nút Lưu
        // const saveBtnContainer = saveBtn.closest('.wrap'); // Tìm container của nút
      }

      if (saveBtn && tenMuaGiaiInput && soDoiThamDuInput) {
        saveBtn.addEventListener("click", function (e) {
          e.preventDefault();
          if (successMsg) successMsg.style.display = "none";

          // *** Thêm kiểm tra currentLeagueId ở đây một lần nữa ***
          if (currentLeagueId === null) {
            alert("Lỗi: Không xác định được Giải đấu. Không thể lưu mùa giải.");
            console.error(
              "DEBUG (addseason): Save cancelled - leagueId is still null."
            );
            return; // Không cho lưu nếu không có leagueId
          }

          const tenMuaGiaiValue = tenMuaGiaiInput.value.trim();
          const soDoiThamDuValue = soDoiThamDuInput.value;

          if (tenMuaGiaiValue === "" || soDoiThamDuValue === "") {
            alert("Vui lòng nhập đầy đủ Tên mùa giải và Số đội tham dự!");
            if (tenMuaGiaiValue === "") tenMuaGiaiInput.focus();
            else soDoiThamDuInput.focus();
            return;
          }
          console.log("DEBUG (addseason): Validation passed.");

          // Lấy các giá trị còn lại...
          const thoiGianBatDauInput = document.getElementById("thoiGianBatDau");
          const thoiGianKetThucInput =
            document.getElementById("thoiGianKetThuc");
          const locationInput = document.getElementById("location");
          const fanpageInput = document.getElementById("fanpage");
          const thoiGianBatDauValue = thoiGianBatDauInput
            ? thoiGianBatDauInput.value
            : "";
          const thoiGianKetThucValue = thoiGianKetThucInput
            ? thoiGianKetThucInput.value
            : "";
          const locationValue = locationInput ? locationInput.value.trim() : "";
          const fanpageValue = fanpageInput ? fanpageInput.value.trim() : "";

          // Tạo object dữ liệu mùa giải - CÓ leagueId
          const newSeasonData = {
            id: Date.now(),
            leagueId: currentLeagueId, // Đã thêm ID giải đấu
            name: tenMuaGiaiValue,
            startDate: thoiGianBatDauValue,
            endDate: thoiGianKetThucValue,
            teamCount: soDoiThamDuValue,
            logo: logoDataUrl,
            wallpaper: wpDataUrl,
            location: locationValue,
            fanpage: fanpageValue,
          };

          // Lưu vào localStorage['danhSachMuaGiai']
          try {
            const storageKey = "danhSachMuaGiai";
            let seasons = JSON.parse(localStorage.getItem(storageKey)) || [];
            seasons.push(newSeasonData);
            localStorage.setItem(storageKey, JSON.stringify(seasons));
            console.log(`DEBUG (addseason): Season saved to '${storageKey}'.`);

            // Chỉ hiện thông báo thành công
            if (successMsg) {
              successMsg.textContent = "Thêm mùa giải thành công!";
              successMsg.style.display = "block";
              console.log("DEBUG (addseason): Success message shown.");
            } else {
              alert("Thêm mùa giải thành công!");
            }
          } catch (error) {
            console.error("DEBUG (addseason): Error saving season:", error);
            alert("Lỗi khi lưu mùa giải. Kiểm tra console (F12).");
          }
        });
      } else {
        console.error(
          "DEBUG (addseason): Critical Error! Missing elements for saving.",
          { saveBtn, tenMuaGiaiInput, soDoiThamDuInput }
        );
        // Không cần alert ở đây nữa vì đã có alert ở trên nếu leagueId null
      }
    </script>
  </body>
</html>
